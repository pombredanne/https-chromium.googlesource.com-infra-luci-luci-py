{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "ccc197dc_fcd586bf",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1547372
      },
      "writtenOn": "2023-11-30T15:05:33Z",
      "side": 1,
      "message": "IMO, this is the simplest fix to the problem that will prevent incident from reoccurring.\nThis solution preserves the blocking nature of the `remote_client.post_task_update` implementation. IE, we wait until a succesful `task_update` until doing further work. This helps with the semantics of keeping chunks sent to swarming small and allows us to modify less code. \n\nI attempted a larger refactoring, but it quickly got too complicated for my liking. \nThe idea was to maintain an \"implicit\" statemachine by pushing actions onto a queue and keeping a state running while the loop was executing. Unfortunately the `run_command` loop uses various variables in many modes of control flow which meant that this refactoring was pretty difficult and would probably take at least a week to do in a reasonable way. Those interested can see the attempt here: https://chromium-review.googlesource.com/c/infra/luci/luci-py/+/5075452 \nIt /might/ be a good idea to do something similar to task_runner in the future, but in my opinion it ended up making things more complicated than a simple `for ... in` loop. \n\nI will add doc comments and more specific unit tests if reviewers think that this is a viable solution.",
      "revId": "d3184cec5502aa154185919c93dd43a11e1a34e4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "70b4f623_7215dc01",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1547372
      },
      "writtenOn": "2023-11-30T15:17:35Z",
      "side": 1,
      "message": "\u003e I will add doc comments and more specific unit tests if reviewers think that this is a viable solution.\n\nI am refering to this CL here.",
      "parentUuid": "ccc197dc_fcd586bf",
      "revId": "d3184cec5502aa154185919c93dd43a11e1a34e4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "476126b0_734f23f3",
        "filename": "appengine/swarming/swarming_bot/bot_code/task_runner.py",
        "patchSetId": 1
      },
      "lineNbr": 709,
      "author": {
        "id": 1547372
      },
      "writtenOn": "2023-11-30T15:17:35Z",
      "side": 1,
      "message": "We may need to borrow `net.is_transient_http_error` for use here - I can imagine this might cause issues for `404` tasks or something otherwise.",
      "range": {
        "startLine": 709,
        "startChar": 4,
        "endLine": 709,
        "endChar": 44
      },
      "revId": "d3184cec5502aa154185919c93dd43a11e1a34e4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "884c44f6_ccfe83e3",
        "filename": "appengine/swarming/swarming_bot/bot_code/task_runner.py",
        "patchSetId": 1
      },
      "lineNbr": 712,
      "author": {
        "id": 1547372
      },
      "writtenOn": "2023-11-30T15:17:35Z",
      "side": 1,
      "message": "This should actually be 5, not 6. Current implementation retries for 240 min in 60s intervals.",
      "range": {
        "startLine": 712,
        "startChar": 34,
        "endLine": 712,
        "endChar": 37
      },
      "revId": "d3184cec5502aa154185919c93dd43a11e1a34e4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "932f4f01_224db64d",
        "filename": "appengine/swarming/swarming_bot/bot_code/task_runner.py",
        "patchSetId": 1
      },
      "lineNbr": 865,
      "author": {
        "id": 1547372
      },
      "writtenOn": "2023-11-30T15:05:33Z",
      "side": 1,
      "message": "Should we add these calls to `combined_pinger` as well? IUUC, RBE does not know that swarming has started working on the lease yet at this point. \n\nShould we tell it early or just let failures here not talk to `rbe` at all?",
      "range": {
        "startLine": 865,
        "startChar": 9,
        "endLine": 865,
        "endChar": 63
      },
      "revId": "d3184cec5502aa154185919c93dd43a11e1a34e4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}