{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "56785bf6_30ec891d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1002539
      },
      "writtenOn": "2022-10-25T20:50:01Z",
      "side": 1,
      "message": "There seem to be a lot of unrelated protos here (mostly under common/proto). How was this CL generated? I think we need to adjust the script to exclude some protos.",
      "revId": "ffa3f1a77a2e964209e0ddcb792adbd56042ed71",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2a81d4dd_0a123e28",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1551397
      },
      "writtenOn": "2022-10-25T21:29:32Z",
      "side": 1,
      "message": "via this script (and the highlighted sub paths) https://source.chromium.org/chromium/infra/infra/+/main:luci/appengine/swarming/bb_backend_proto/update_taskbackend_protos.py;l\u003d28-34?q\u003dupdate_taskbackend\u0026ss\u003dchromium\n\nAlso most of these protos already existed in this folder, this was just an update. I can adjust the script as needed, but I think it might turn into a \"here are the exact files needed\" script... which is fine if thats the level of granularity we want.",
      "parentUuid": "56785bf6_30ec891d",
      "revId": "ffa3f1a77a2e964209e0ddcb792adbd56042ed71",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4a9935ac_de89e3a9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1002539
      },
      "writtenOn": "2022-10-26T17:37:47Z",
      "side": 1,
      "message": "This script has at least two issues:\n1. It copies Swarming own protos back into luci-py, resulting in duplicated protos which is very confusing:\n * Original: https://chromium.googlesource.com/infra/luci/luci-py/+/refs/heads/main/appengine/swarming/proto/api/swarming.proto\n * Copy of a copy: https://chromium.googlesource.com/infra/luci/luci-py/+/refs/heads/main/appengine/swarming/bb_backend_proto/go.chromium.org/luci/swarming/proto/api/swarming.proto\n\n2. At least this stuff is copied uselessly https://chromium.googlesource.com/infra/luci/luci-go/+/refs/heads/main/common/proto/googleapis/. It needs to passed to protoc via separate `--proto_path` to take any effect (e.g. like cproto does https://chromium.googlesource.com/infra/luci/luci-go/+/refs/heads/main/common/proto/protoc/inputs.go#164). update_taskbackend_protos.py doesn\u0027t do this, yet everything works, thus I think all copied proto/googleapis/ is useless junk.\n\nI think the script should copy ONLY files that are necessary in luci-py, especially considering its copying them under \"appengine/swarming\" directory. It should be only files necessary by Swarming, not all random junk in luci-go repo. And it definitely should not copy Swarming protos back into Swarming under a different name.\n\nIf you prefer, I can make these changes. Let me know.",
      "parentUuid": "2a81d4dd_0a123e28",
      "revId": "ffa3f1a77a2e964209e0ddcb792adbd56042ed71",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bb6edac9_20b4bf95",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1551397
      },
      "writtenOn": "2022-10-26T17:56:02Z",
      "side": 1,
      "message": "what if I just created a new script to update https://chromium.googlesource.com/infra/luci/luci-py/+/refs/heads/main/appengine/swarming/proto/api/\n\nso that only the necessary buildbucket protos (really just backend.proto) are copied over. That way we can remove all the junk. There is another set of coppied protos inside `appengine/swarming/proto/api/internal/bb` with a TODO that states that we should do some cleanup. https://chromium.googlesource.com/infra/luci/luci-py/+/refs/heads/main/appengine/swarming/proto/api/internal/bb/backend.proto#12 \n\nThis would achieve the following:\n\n1. remove `appengine/swarming/bb_backend_proto`\n2. remove `appengine/swarming/proto/api/internal/bb`\n3. place all necessary protos inside `appengine/swarming/proto/api` so that there is a central location for the protos (like I said I think we just need `backend.proto`)\n4. the script (`update_protos.py`) would live inside `appengine/swarming/proto/api`\n\nthoughts?",
      "parentUuid": "4a9935ac_de89e3a9",
      "revId": "ffa3f1a77a2e964209e0ddcb792adbd56042ed71",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "49c5b387_ff6207f5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1002539
      },
      "writtenOn": "2022-10-26T18:13:51Z",
      "side": 1,
      "message": "The problem is that backend.proto imports other protos using absolute import paths like `import \"go.chromium.org/luci/buildbucket/proto/common.proto\"` and they import other protos and so on.\n\nFor this to work without modifying *.proto content, files need to be located in corresponding directories in the file system. This is what \"bb_backend_proto\" is trying to do, except I believe it pulls in lots of unnecessary stuff.\n\nHere\u0027s another proposal: what if we don\u0027t copy *.proto files at all and just commit necessary generated _pb2.py files (using original protos in the original repository to generate them).\n\nEither way, some trimming is necessary to identify transitive dependencies of backend.proto and generate code only for them.",
      "parentUuid": "bb6edac9_20b4bf95",
      "revId": "ffa3f1a77a2e964209e0ddcb792adbd56042ed71",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}