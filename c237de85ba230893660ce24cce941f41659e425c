{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "59a60076_38db0808",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1547372
      },
      "writtenOn": "2023-11-10T23:55:58Z",
      "side": 1,
      "message": "Would like some early feedback on this approach before I spend more time fixing tests and doing cleanup. \n\nMy first attempt at the linked bug was to find a faster way to write `get_recursive_size`. I think `os.scandir` is actually quite fast already, at least on `linux`. I tested it against `du` and it was actually faster. Have not tested on `macos` yet. \n\nIt occurred to me that we probably don\u0027t need to actually calculate the sizes of the `named_cache` until after the task is complete. IUUC its not used for anything useful besides logging.\n\nEven if some caches show `zero` for their file size, this probably won\u0027t effect the name cache hints bc https://source.chromium.org/chromium/infra/infra/+/main:luci/appengine/swarming/server/named_caches.py;l\u003d208\n\nTrimming function which runs before execution doesn\u0027t even rely on the actual sizes of the `NamedCache`. Only the `hints` which it gets from the server. \n\nSo I don\u0027t see why we need to calculate `cache size` during a task, specially if it\u0027s expensive.",
      "revId": "c237de85ba230893660ce24cce941f41659e425c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}