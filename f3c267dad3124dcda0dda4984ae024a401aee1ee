{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "907d30e3_90a8674a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 21
      },
      "lineNbr": 0,
      "author": {
        "id": 1002539
      },
      "writtenOn": "2023-07-06T17:27:29Z",
      "side": 1,
      "message": "The logic should be implemented inside task_scheduler.bot_update_task(...), or at least somewhere under server/*. Doing it inside HTTP handler is a layering violation (and, for example, will make it harder converting bot handlers to pRPC). In fact, bot_update_task(...) already has some pubsub stuff that can likely be reused, at least partially. For example, it reports some metrics related to pubsub pushes. We should report similar metrics for new pushes.\n\nI also have concerns related to idempotency of this. With existing pubsub stuff, if it fails, it aborts the handler relatively early, before bot_management.bot_event(...). With new pubsub stuff, failures (+ subsequent retries by the bot) will result in repeated calls to bot_management.bot_event(...) which is potentially not very good.\n\nFinally, PubSub messages can be delivered out of order. Will BB be able to handle this correctly?\n\nAlso what\u0027s up with random `has_permission` mocks?",
      "revId": "f3c267dad3124dcda0dda4984ae024a401aee1ee",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4646c6f3_2cac1ede",
        "filename": "appengine/swarming/handlers_bot.py",
        "patchSetId": 21
      },
      "lineNbr": 1347,
      "author": {
        "id": 1002539
      },
      "writtenOn": "2023-07-06T17:27:29Z",
      "side": 1,
      "message": "Isn\u0027t it supposed to be `cr-buildbucket`? Topics are hosted in Buildbucket project.",
      "range": {
        "startLine": 1347,
        "startChar": 45,
        "endLine": 1347,
        "endChar": 55
      },
      "revId": "f3c267dad3124dcda0dda4984ae024a401aee1ee",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d8353e10_f2914934",
        "filename": "appengine/swarming/handlers_bot.py",
        "patchSetId": 21
      },
      "lineNbr": 1347,
      "author": {
        "id": 1551397
      },
      "writtenOn": "2023-07-11T16:56:58Z",
      "side": 1,
      "message": "yes. changing. gonna add in a \"isDev\"? check too.",
      "parentUuid": "4646c6f3_2cac1ede",
      "range": {
        "startLine": 1347,
        "startChar": 45,
        "endLine": 1347,
        "endChar": 55
      },
      "revId": "f3c267dad3124dcda0dda4984ae024a401aee1ee",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3c51d995_0afa931f",
        "filename": "appengine/swarming/handlers_bot.py",
        "patchSetId": 21
      },
      "lineNbr": 1530,
      "author": {
        "id": 1547372
      },
      "writtenOn": "2023-07-06T19:54:44Z",
      "side": 1,
      "message": "Prefer using `task_pack.unpack_request_key` since we don\u0027t need the error handling in `api_common.to_keys` as the `task_id` is already valid at this point.",
      "range": {
        "startLine": 1530,
        "startChar": 23,
        "endLine": 1530,
        "endChar": 50
      },
      "revId": "f3c267dad3124dcda0dda4984ae024a401aee1ee",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0c38b676_3a65623d",
        "filename": "appengine/swarming/handlers_bot.py",
        "patchSetId": 21
      },
      "lineNbr": 1530,
      "author": {
        "id": 1551397
      },
      "writtenOn": "2023-07-11T16:56:58Z",
      "side": 1,
      "message": "sgtm! changed.",
      "parentUuid": "3c51d995_0afa931f",
      "range": {
        "startLine": 1530,
        "startChar": 23,
        "endLine": 1530,
        "endChar": 50
      },
      "revId": "f3c267dad3124dcda0dda4984ae024a401aee1ee",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7e16ccf0_e4228be0",
        "filename": "appengine/swarming/handlers_bot.py",
        "patchSetId": 21
      },
      "lineNbr": 1570,
      "author": {
        "id": 1002539
      },
      "writtenOn": "2023-07-06T17:27:29Z",
      "side": 1,
      "message": "where is this set?",
      "range": {
        "startLine": 1570,
        "startChar": 9,
        "endLine": 1570,
        "endChar": 31
      },
      "revId": "f3c267dad3124dcda0dda4984ae024a401aee1ee",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8ebba94a_48c612f1",
        "filename": "appengine/swarming/handlers_bot.py",
        "patchSetId": 21
      },
      "lineNbr": 1570,
      "author": {
        "id": 1551397
      },
      "writtenOn": "2023-07-11T16:56:58Z",
      "side": 1,
      "message": "good call out. I was confusing the pb.Task.Status being set with BuildTask.task_status being set.\n\nI added in logic that sets the task status for BuildTask",
      "parentUuid": "7e16ccf0_e4228be0",
      "range": {
        "startLine": 1570,
        "startChar": 9,
        "endLine": 1570,
        "endChar": 31
      },
      "revId": "f3c267dad3124dcda0dda4984ae024a401aee1ee",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}