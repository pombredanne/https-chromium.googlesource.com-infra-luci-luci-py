{
  "comments": [
    {
      "key": {
        "uuid": "a3666cb4_3bcd5f2d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 10,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2020-05-28T01:44:02Z",
      "side": 1,
      "message": "I would like to have tests in this CL.",
      "range": {
        "startLine": 10,
        "startChar": 0,
        "endLine": 10,
        "endChar": 14
      },
      "revId": "d1ea7aec4ea766e683e429c372884a0d31eece48",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fa0473cb_331a9d35",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 10,
      "author": {
        "id": 1336288
      },
      "writtenOn": "2020-05-28T19:18:09Z",
      "side": 1,
      "message": "Yes. I mentioned in the message. I want to attach a unit test within this CL.\nBut need some input, where is best to add such a unittest?",
      "parentUuid": "a3666cb4_3bcd5f2d",
      "range": {
        "startLine": 10,
        "startChar": 0,
        "endLine": 10,
        "endChar": 14
      },
      "revId": "d1ea7aec4ea766e683e429c372884a0d31eece48",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "798dde51_33605a74",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 10,
      "author": {
        "id": 1336288
      },
      "writtenOn": "2020-05-28T21:36:31Z",
      "side": 1,
      "message": "Done. Attached.",
      "parentUuid": "fa0473cb_331a9d35",
      "range": {
        "startLine": 10,
        "startChar": 0,
        "endLine": 10,
        "endChar": 14
      },
      "revId": "d1ea7aec4ea766e683e429c372884a0d31eece48",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7e1d6a84_c981b2a5",
        "filename": "appengine/swarming/server/external_scheduler.py",
        "patchSetId": 6
      },
      "lineNbr": 82,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2020-05-28T01:44:02Z",
      "side": 1,
      "message": "How about adding \"default_external_scheduler\" to pool_cfg? so it doesn\u0027t depends on the order.\nYou will just add the following lines before the \u0027return None\u0027.\n\n\u0027\u0027\u0027\nes_cfg \u003d pool_cfg.default_external_scheduler\nif ef_cfg and ef_cfg.enabled and ef_cfg.dimensions.issubset(dimensions_flat):\n  return ef_cfg\n\u0027\u0027\u0027",
      "range": {
        "startLine": 82,
        "startChar": 11,
        "endLine": 82,
        "endChar": 17
      },
      "revId": "d1ea7aec4ea766e683e429c372884a0d31eece48",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a91bd46d_d38d3321",
        "filename": "appengine/swarming/server/external_scheduler.py",
        "patchSetId": 6
      },
      "lineNbr": 82,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2020-05-28T01:51:02Z",
      "side": 1,
      "message": "Ah, you still need to return None for some pools.\n\nThe loop will be something like\n\n\nfor e in pool_cfg.external_schedulers:\n  if not e.dimensions.issubset(dimensions_flat):\n    continue\n  return e if e.enabled else None",
      "parentUuid": "7e1d6a84_c981b2a5",
      "range": {
        "startLine": 82,
        "startChar": 11,
        "endLine": 82,
        "endChar": 17
      },
      "revId": "d1ea7aec4ea766e683e429c372884a0d31eece48",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "11ae1845_f0392468",
        "filename": "appengine/swarming/server/external_scheduler.py",
        "patchSetId": 6
      },
      "lineNbr": 82,
      "author": {
        "id": 1336288
      },
      "writtenOn": "2020-05-28T19:18:09Z",
      "side": 1,
      "message": "Err... NACK, because I think this only works for the pattern (default + exceptions).\nJust in case, if we have to roll back the config to current form:\n\n```\n  external_schedulers {\n    address: \"qscheduler-prod.chromium.org\"\n    dimensions: \"dut_state:ready\"\n    dimensions: \"label-pool:DUT_POOL_QUOTA\"\n    enabled: true\n    id: \"all\"\n  }\n```\nThen CTS pool will become QS true, while it is expected to be false.\nPlus, I think the order upon the matched dimensions is natural for the configuration operator. \nIf two rules are conflicting, the more \"matched\" wins. Looks good?",
      "parentUuid": "a91bd46d_d38d3321",
      "range": {
        "startLine": 82,
        "startChar": 11,
        "endLine": 82,
        "endChar": 17
      },
      "revId": "d1ea7aec4ea766e683e429c372884a0d31eece48",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d494e81c_ada70f77",
        "filename": "appengine/swarming/server/external_scheduler.py",
        "patchSetId": 6
      },
      "lineNbr": 82,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2020-05-29T22:18:09Z",
      "side": 1,
      "message": "Ok, The updated code looks simple enough\n\n\n\u003e Plus, I think the order upon the matched dimensions is natural for the configuration operator. \n\nOk, but it\u0027s implicit to sort them by length of dimensions.\n(People who configure external schedulers need to know the rule)\n\nSo why not just using the config as is?",
      "parentUuid": "11ae1845_f0392468",
      "range": {
        "startLine": 82,
        "startChar": 11,
        "endLine": 82,
        "endChar": 17
      },
      "revId": "d1ea7aec4ea766e683e429c372884a0d31eece48",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c6797fe7_c6a85e3c",
        "filename": "appengine/swarming/server/external_scheduler.py",
        "patchSetId": 6
      },
      "lineNbr": 82,
      "author": {
        "id": 1336288
      },
      "writtenOn": "2020-05-29T22:42:44Z",
      "side": 1,
      "message": "Thanks. \n\n\u003e (People who configure external schedulers need to know the rule)\n\nThis only happens when two rules are conflicting. And yes, user should be aware of it. I will add some clarifications in that config file.\nFYI: QS is using the same way to match bot and task.\n\n\u003e So why not just using the config as is?\nIn that case(you mean the current config file?), we need to change the config whenever a new pool is created. Engprod team does have a lot of updates on their pools.\n\nOr you mean the order that rules are placed in the config?",
      "parentUuid": "d494e81c_ada70f77",
      "range": {
        "startLine": 82,
        "startChar": 11,
        "endLine": 82,
        "endChar": 17
      },
      "revId": "d1ea7aec4ea766e683e429c372884a0d31eece48",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4cd6d379_700412dc",
        "filename": "appengine/swarming/server/external_scheduler.py",
        "patchSetId": 6
      },
      "lineNbr": 82,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2020-05-30T01:11:45Z",
      "side": 1,
      "message": "\u003e Or you mean the order that rules are placed in the config?\n\nI meant this. Isn\u0027t it more explicit for users?",
      "parentUuid": "c6797fe7_c6a85e3c",
      "range": {
        "startLine": 82,
        "startChar": 11,
        "endLine": 82,
        "endChar": 17
      },
      "revId": "d1ea7aec4ea766e683e429c372884a0d31eece48",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4e2c4759_12220d11",
        "filename": "appengine/swarming/server/external_scheduler.py",
        "patchSetId": 6
      },
      "lineNbr": 82,
      "author": {
        "id": 1336288
      },
      "writtenOn": "2020-05-30T07:03:37Z",
      "side": 1,
      "message": "I am not sure how other configs managed in swarming, but I am not prone to do that.\nConsidering that bluetooth, wifi and usb each have multiple pools. Definitely, we want to\ngroup the pools together, like below:\n\n\u003d\u003d\u003d\u003d\u003d\u003d Wifi pools begin \u003d\u003d\u003d\u003d\u003d\n...\n\u003d\u003d\u003d\u003d\u003d\u003d Wifi pools end \u003d\u003d\u003d\u003d\u003d\nIt is hard to maintain the configs, if we have to split them due to the order.\n\n(I understand that the pool config probably will not go to that complicated. So if you insist on following the config order, I am ok too).",
      "parentUuid": "4cd6d379_700412dc",
      "range": {
        "startLine": 82,
        "startChar": 11,
        "endLine": 82,
        "endChar": 17
      },
      "revId": "d1ea7aec4ea766e683e429c372884a0d31eece48",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a9b062d6_63cd3d2d",
        "filename": "appengine/swarming/server/external_scheduler.py",
        "patchSetId": 6
      },
      "lineNbr": 82,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2020-06-01T01:32:52Z",
      "side": 1,
      "message": "\u003e I am not sure how other configs managed in swarming, \n\nIn bots.cfg, the default is defined at the bottom because it would match to all bots if it\u0027s placed at middle (or the top). So I prefer a similar convention for consistency.\nI think the external scheduler configs won\u0027t become complicated any more.\nhttps://chrome-internal.googlesource.com/infradata/config/+/refs/heads/master/configs/chromeos-swarming/bots.cfg#580",
      "parentUuid": "4e2c4759_12220d11",
      "range": {
        "startLine": 82,
        "startChar": 11,
        "endLine": 82,
        "endChar": 17
      },
      "revId": "d1ea7aec4ea766e683e429c372884a0d31eece48",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c991c0e9_d8327421",
        "filename": "appengine/swarming/server/external_scheduler.py",
        "patchSetId": 6
      },
      "lineNbr": 82,
      "author": {
        "id": 1336288
      },
      "writtenOn": "2020-06-01T17:18:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a9b062d6_63cd3d2d",
      "range": {
        "startLine": 82,
        "startChar": 11,
        "endLine": 82,
        "endChar": 17
      },
      "revId": "d1ea7aec4ea766e683e429c372884a0d31eece48",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3135c903_da4d448e",
        "filename": "appengine/swarming/server/external_scheduler.py",
        "patchSetId": 6
      },
      "lineNbr": 88,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2020-05-28T01:44:02Z",
      "side": 1,
      "message": "I\u0027m curious why you need to change this condition.",
      "range": {
        "startLine": 88,
        "startChar": 19,
        "endLine": 88,
        "endChar": 34
      },
      "revId": "d1ea7aec4ea766e683e429c372884a0d31eece48",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b8a390df_809cf686",
        "filename": "appengine/swarming/server/external_scheduler.py",
        "patchSetId": 6
      },
      "lineNbr": 88,
      "author": {
        "id": 1336288
      },
      "writtenOn": "2020-05-28T19:18:09Z",
      "side": 1,
      "message": "Ack.",
      "parentUuid": "3135c903_da4d448e",
      "range": {
        "startLine": 88,
        "startChar": 19,
        "endLine": 88,
        "endChar": 34
      },
      "revId": "d1ea7aec4ea766e683e429c372884a0d31eece48",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}